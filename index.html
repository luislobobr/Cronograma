<!DOCTYPE html>
<html lang="pt-BR" class="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vinci Projects - Gerenciador de Projetos</title>
    <!-- Fonte moderna Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- External CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<body class="antialiased">
    <div id="loader" class="no-print">
        <div class="spinner"></div>
    </div>

    <div id="toast-container" class="no-print"></div>

    <!-- Modal de Autenticação -->
    <div id="auth-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50 modal-transition modal-visible">
        <div class="bg-[var(--card-bg)] rounded-xl shadow-2xl p-8 w-full max-w-md">
            <!-- Logo Vinci Projects -->
            <div class="flex items-center gap-3 mb-6">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="48" height="48" rx="10" fill="url(#vinci-gradient)" />
                    <text x="24" y="30" text-anchor="middle" fill="#2563eb" font-family="Montserrat, sans-serif"
                        font-weight="800" font-size="22">V</text>
                    <defs>
                        <linearGradient id="vinci-gradient" x1="0" y1="0" x2="48" y2="48"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="#1e1e1e" />
                            <stop offset="1" stop-color="#2d2d2d" />
                        </linearGradient>
                    </defs>
                </svg>
                <div>
                    <h1 class="text-2xl font-bold" style="font-family: 'Montserrat', sans-serif; color: #2563eb;">Vinci
                        Projects</h1>
                    <p class="text-xs text-gray-400">Gestão de Projetos</p>
                </div>
            </div>
            <h2 class="text-2xl font-bold mb-2" style="color: #2563eb;">Bem-vindo</h2>
            <p class="text-gray-400 mb-6 text-left">Acesso restrito ao domínio @vinci-highways.com.br</p>

            <form id="auth-form" class="space-y-4">
                <input type="email" id="auth-email" placeholder="E-mail (@vinci-highways.com.br)"
                    class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-3 bg-transparent"
                    required>
                <input type="password" id="auth-password" placeholder="Senha"
                    class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-3 bg-transparent"
                    required>

                <div class="flex justify-between items-center">
                    <button type="button" id="forgot-password-btn"
                        class="text-sm text-orange-500 hover:underline transition-colors">Esqueci minha senha</button>
                    <button type="button" id="toggle-auth-mode"
                        class="text-sm text-blue-500 hover:underline transition-colors">Precisa de uma conta?
                        Registrar</button>
                </div>

                <div class="flex justify-end gap-2">
                    <button type="submit" id="auth-submit-btn"
                        class="w-full bg-blue-600 text-white px-4 py-3 rounded-md font-semibold hover:bg-blue-700 transition-colors">Login</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Cadastro de Usuário -->
    <div id="add-user-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center no-print modal-transition modal-hidden modal-z-60">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4 text-[var(--text-color)]">Cadastrar Novo Usuário</h2>
            <form id="add-user-form">
                <div class="mb-4">
                    <label for="new-user-name" class="block text-sm font-medium text-gray-400">Nome Completo</label>
                    <input type="text" id="new-user-name"
                        class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-2 bg-transparent">
                    <p class="text-xs text-gray-500 mt-1">Opcional - será preenchido automaticamente com o nome do
                        e-mail</p>
                </div>
                <div class="mb-4">
                    <label for="new-user-email" class="block text-sm font-medium text-gray-400">E-mail</label>
                    <input type="email" id="new-user-email"
                        class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-2 bg-transparent"
                        required>
                    <p class="text-xs text-gray-500 mt-1">Deve terminar com @vinci-highways.com.br</p>
                </div>
                <div class="mb-4">
                    <label for="new-user-role" class="block text-sm font-medium text-gray-400">Papel</label>
                    <select id="new-user-role"
                        class="mt-1 block w-full border border-[var(--border-color)] bg-[var(--card-bg)] rounded-md shadow-sm p-2">
                        <option value="Usuario">Usuário</option>
                        <option value="Gestor">Gestor</option>
                        <option value="admin" id="new-user-role-admin-option" class="hidden">Admin (Acesso Total)
                        </option>
                    </select>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button"
                        class="cancel-btn bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">Cancelar</button>
                    <button type="submit"
                        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Cadastrar Usuário</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Gestão de Usuários -->
    <div id="user-management-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center no-print modal-transition modal-hidden modal-z-50">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-6xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-[var(--text-color)]">Gestão de Utilizadores e Papéis</h2>
                <button id="add-user-btn"
                    class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                            clip-rule="evenodd" />
                    </svg>
                    Cadastrar Usuário
                </button>
            </div>
            <div id="user-list-container" class="overflow-y-auto max-h-96">
                <table class="w-full text-sm text-left text-gray-400">
                    <thead class="text-xs uppercase bg-gray-700 text-gray-400 sticky top-0">
                        <tr>
                            <th class="p-3">Nome</th>
                            <th class="p-3">E-mail</th>
                            <th class="p-3">Papel Atual</th>
                            <th class="p-3">Status</th>
                            <th class="p-3 text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="user-management-table-body">
                    </tbody>
                </table>
            </div>
            <div class="flex justify-end mt-4">
                <button type="button"
                    class="cancel-btn bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">Fechar</button>
            </div>
        </div>
    </div>

    <!-- NOVO: Modal de Gestão de Setores (Admin) -->
    <div id="sector-management-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center no-print modal-transition modal-hidden modal-z-50">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-4xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-[var(--text-color)] flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-purple-500" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path
                            d="M3 3h8v8H3V3zm2 2v4h4V5H5zm8-2h8v8h-8V3zm2 2v4h4V5h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5zm13 0v6h2v-6h-2zm-4 2v4h2v-4h-2zm8 0v4h2v-4h-2z" />
                    </svg>
                    Gestão de Setores
                </h2>
                <button id="add-sector-btn"
                    class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                            clip-rule="evenodd" />
                    </svg>
                    Novo Setor
                </button>
            </div>
            <p class="text-gray-400 text-sm mb-4">
                Setores organizam projetos e controlam o acesso dos usuários. Gestores só veem projetos do seu setor.
            </p>
            <div id="sector-list-container" class="overflow-y-auto max-h-96">
                <table class="w-full text-sm text-left text-gray-400">
                    <thead class="text-xs uppercase bg-gray-700 text-gray-400 sticky top-0">
                        <tr>
                            <th class="p-3">Nome do Setor</th>
                            <th class="p-3">Descrição</th>
                            <th class="p-3">Projetos</th>
                            <th class="p-3">Gestores</th>
                            <th class="p-3 text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="sector-management-table-body">
                    </tbody>
                </table>
            </div>
            <div class="flex justify-end mt-4">
                <button type="button"
                    class="cancel-btn bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">Fechar</button>
            </div>
        </div>
    </div>

    <!-- NOVO: Modal de Formulário de Setor -->
    <div id="sector-form-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center no-print modal-transition modal-hidden modal-z-60">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-md">
            <h2 id="sector-form-title" class="text-2xl font-bold mb-4 text-[var(--text-color)]">Novo Setor</h2>
            <form id="sector-form">
                <input type="hidden" id="sector-id">
                <div class="mb-4">
                    <label for="sector-name" class="block text-sm font-medium text-gray-400">Nome do Setor</label>
                    <input type="text" id="sector-name"
                        class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-2 bg-transparent"
                        required placeholder="Ex: Projetos, Financeiro, RH...">
                </div>
                <div class="mb-4">
                    <label for="sector-description" class="block text-sm font-medium text-gray-400">Descrição</label>
                    <textarea id="sector-description" rows="3"
                        class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-2 bg-transparent resize-none"
                        placeholder="Descrição opcional do setor..."></textarea>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button"
                        class="cancel-btn bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">Cancelar</button>
                    <button type="submit"
                        class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700">Salvar
                        Setor</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Edição de Utilizador -->
    <div id="edit-user-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center no-print modal-transition modal-hidden modal-z-60">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4 text-[var(--text-color)]">Editar Utilizador</h2>
            <form id="edit-user-form">
                <input type="hidden" id="edit-user-id">
                <div class="mb-4">
                    <label for="edit-user-name" class="block text-sm font-medium text-gray-400">Nome</label>
                    <input type="text" id="edit-user-name"
                        class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-2 bg-transparent"
                        required>
                </div>
                <div class="mb-4">
                    <label for="edit-user-email" class="block text-sm font-medium text-gray-400">E-mail</label>
                    <input type="email" id="edit-user-email"
                        class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-2 bg-transparent"
                        required>
                    <p class="text-xs text-gray-500 mt-1">Deve terminar com @vinci-highways.com.br</p>
                </div>
                <div class="mb-4">
                    <label for="edit-user-role" class="block text-sm font-medium text-gray-400">Papel</label>
                    <select id="edit-user-role"
                        class="mt-1 block w-full border border-[var(--border-color)] bg-[var(--card-bg)] rounded-md shadow-sm p-2">
                        <option value="Usuario">Usuário</option>
                        <option value="Gestor">Gestor</option>
                        <option value="admin" id="edit-user-role-admin-option" class="hidden">Admin (Acesso Total)
                        </option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Admins têm controle total do sistema</p>
                </div>
                <!-- CAMPO DE SETOR -->
                <div class="mb-4">
                    <label for="edit-user-sector" class="block text-sm font-medium text-gray-400">Setor</label>
                    <select id="edit-user-sector"
                        class="mt-1 block w-full border border-[var(--border-color)] bg-[var(--card-bg)] rounded-md shadow-sm p-2">
                        <option value="">Selecione um setor...</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Gestores só veem projetos do seu setor</p>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-400 mb-2">Status da Conta</label>
                    <div class="flex items-center">
                        <label class="user-status-toggle">
                            <input type="checkbox" id="edit-user-active" checked>
                            <span class="user-status-slider"></span>
                        </label>
                        <span id="edit-user-status-label" class="user-status-label active">Ativo</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Utilizadores inativos não podem aceder ao sistema</p>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button"
                        class="cancel-btn bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">Cancelar</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Guardar
                        Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Ajustes de Importação -->
    <div id="import-adjustment-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 no-print modal-transition modal-hidden">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-6xl max-h-[90vh] overflow-hidden">
            <h2 class="text-2xl font-bold mb-4 text-[var(--text-color)]">Ajustar Tarefas Importadas</h2>

            <div class="mb-4 p-4 bg-yellow-100 dark:bg-yellow-900 rounded-lg">
                <h3 class="font-bold text-yellow-800 dark:text-yellow-200 mb-2">Problemas Encontrados:</h3>
                <div id="import-errors-list" class="text-sm text-yellow-700 dark:text-yellow-300"></div>
            </div>

            <div class="overflow-y-auto max-h-96 mb-4">
                <table class="w-full text-sm text-left text-gray-400">
                    <thead class="text-xs uppercase bg-gray-700 text-gray-400 sticky top-0">
                        <tr>
                            <th class="p-2">Linha</th>
                            <th class="p-2">Tarefa</th>
                            <th class="p-2">Data Início</th>
                            <th class="p-2">Data Término</th>
                            <th class="p-2">Status</th>
                            <th class="p-2">Responsáveis</th>
                            <th class="p-2">Tarefa Pai</th>
                            <th class="p-2">Problemas</th>
                            <th class="p-2 text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="import-adjustment-table-body">
                    </tbody>
                </table>
            </div>

            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-400">
                    <span id="import-valid-count">0</span> tarefas válidas de
                    <span id="import-total-count">0</span> total
                </div>
                <div class="flex gap-2">
                    <button id="cancel-import-btn"
                        class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                        Cancelar
                    </button>
                    <button id="confirm-import-btn"
                        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        Importar Tarefas Válidas (<span id="confirm-count">0</span>)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Projeto -->
    <div id="project-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 no-print modal-transition modal-hidden">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-md">
            <h2 id="project-modal-title" class="text-2xl font-bold mb-4 text-[var(--text-color)]">Novo Projeto</h2>
            <form id="project-form">
                <div class="mb-4">
                    <label for="project-name" class="block text-sm font-medium text-gray-400">Nome do Projeto</label>
                    <input type="text" id="project-name"
                        class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-2 bg-transparent"
                        required>
                </div>
                <div class="mb-4">
                    <label for="project-manager" class="block text-sm font-medium text-gray-400">Responsável</label>
                    <select id="project-manager"
                        class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-2 bg-transparent"
                        required>
                        <option value="">Selecione um responsável</option>
                    </select>
                </div>
                <!-- NOVO: Dropdown de Setor -->
                <div class="mb-4" id="project-sector-container">
                    <label for="project-sector" class="block text-sm font-medium text-gray-400">Setor</label>
                    <select id="project-sector"
                        class="mt-1 block w-full border border-[var(--border-color)] rounded-md shadow-sm p-2 bg-[var(--card-bg)]">
                        <option value="">Sem setor específico</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Atribua o projeto a um setor para controle de acesso</p>
                </div>
                <!-- NOVO: Campos de data de início e término do projeto -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="project-start-date" class="block text-sm font-medium text-gray-400">Data de
                            Início</label>
                        <input type="date" id="project-start-date"
                            class="mt-1 block w-full border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-2"
                            required>
                    </div>
                    <div>
                        <label for="project-end-date" class="block text-sm font-medium text-gray-400">Data de
                            Término</label>
                        <input type="date" id="project-end-date"
                            class="mt-1 block w-full border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-2"
                            required>
                    </div>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button"
                        class="cancel-btn bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">Cancelar</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Salvar
                        Projeto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Edição de Data do Projeto -->
    <div id="project-date-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 no-print modal-transition modal-hidden">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-md">
            <h2 class="text-2xl font-bold mb-4 text-[var(--text-color)]">Editar Projeto</h2>
            <form id="project-date-form">
                <input type="hidden" id="edit-project-id">
                <!-- Campo de Nome do Projeto -->
                <div class="mb-4">
                    <label for="edit-project-name" class="block text-sm font-medium text-gray-400">Nome do
                        Projeto</label>
                    <input type="text" id="edit-project-name"
                        class="mt-1 block w-full border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-2"
                        required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="edit-project-start-date" class="block text-sm font-medium text-gray-400">Data de
                            Início</label>
                        <input type="date" id="edit-project-start-date"
                            class="mt-1 block w-full border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-2"
                            required>
                    </div>
                    <div>
                        <label for="edit-project-end-date" class="block text-sm font-medium text-gray-400">Data de
                            Término</label>
                        <input type="date" id="edit-project-end-date"
                            class="mt-1 block w-full border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-2"
                            required>
                    </div>
                </div>
                <div class="mb-4 p-3 bg-blue-50 dark:bg-blue-900 rounded-md">
                    <p class="text-sm text-blue-700 dark:text-blue-300">
                        <strong>Atenção:</strong> Alterar as datas do projeto pode afetar todas as tarefas vinculadas.
                    </p>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button"
                        class="cancel-btn bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">Cancelar</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Salvar
                        Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Tarefa - VERSÃO MELHORADA COM ANEXOS E ATIVIDADE -->
    <div id="task-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 no-print modal-transition modal-hidden">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 id="modal-title" class="text-2xl font-bold text-[var(--text-color)]">Adicionar Nova Tarefa</h2>
                <button type="button" class="cancel-btn text-gray-400 hover:text-gray-600 p-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <form id="task-form" class="space-y-6">
                <input type="hidden" id="task-id">
                <input type="hidden" id="parent-id">

                <!-- SEÇÃO 1: Informações Básicas -->
                <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                    <h3
                        class="text-lg font-semibold mb-4 text-[var(--text-color)] border-b pb-2 flex items-center gap-2">
                        <span
                            class="bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold">1</span>
                        Informações Básicas
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Nome da Tarefa -->
                        <div class="md:col-span-2">
                            <label for="task-name" class="block text-sm font-medium text-gray-400 mb-1">
                                Nome da Tarefa <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="task-name"
                                class="w-full border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                required placeholder="Ex: Elaborar relatório mensal, Revisar documentação...">
                            <p class="text-xs text-gray-500 mt-1">Descreva de forma clara o que precisa ser feito</p>
                        </div>

                        <!-- Tarefa Pai (Nova opção) -->
                        <div class="md:col-span-2">
                            <label for="task-parent-select" class="block text-sm font-medium text-gray-400 mb-1">
                                Tarefa Pai (opcional)
                            </label>
                            <select id="task-parent-select"
                                class="w-full border border-[var(--border-color)] bg-[var(--card-bg)] rounded-md shadow-sm p-3">
                                <option value="">Nenhuma (tarefa principal)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Selecione uma tarefa pai para criar uma subtarefa</p>
                        </div>

                        <!-- Prioridade e Status -->
                        <div>
                            <label for="task-priority" class="block text-sm font-medium text-gray-400 mb-1">
                                Prioridade
                            </label>
                            <div class="relative">
                                <select id="task-priority"
                                    class="w-full border border-[var(--border-color)] bg-[var(--card-bg)] rounded-md shadow-sm p-3 appearance-none">
                                    <option value="Baixa">🟢 Baixa</option>
                                    <option value="Média" selected>🟡 Média</option>
                                    <option value="Alta">🔴 Alta</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label for="task-status" class="block text-sm font-medium text-gray-400 mb-1">
                                Status Inicial
                            </label>
                            <select id="task-status"
                                class="w-full border border-[var(--border-color)] bg-[var(--card-bg)] rounded-md shadow-sm p-3">
                                <option value="Não Iniciada">⏳ Não Iniciada</option>
                                <option value="Em Andamento">🔄 Em Andamento</option>
                                <option value="Concluída">✅ Concluída</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- SEÇÃO 2: Datas e Prazos -->
                <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                    <h3
                        class="text-lg font-semibold mb-4 text-[var(--text-color)] border-b pb-2 flex items-center gap-2">
                        <span
                            class="bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold">2</span>
                        Datas e Prazos
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="start-date" class="block text-sm font-medium text-gray-400 mb-1">
                                Data de Início <span class="text-red-500">*</span>
                            </label>
                            <input type="date" id="start-date"
                                class="w-full border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-3 focus:ring-2 focus:ring-blue-500"
                                required>
                            <p class="text-xs text-gray-500 mt-1">Quando a tarefa deve começar</p>
                        </div>

                        <div>
                            <label for="end-date" class="block text-sm font-medium text-gray-400 mb-1">
                                Data de Término <span class="text-red-500">*</span>
                            </label>
                            <input type="date" id="end-date"
                                class="w-full border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-3 focus:ring-2 focus:ring-blue-500"
                                required>
                            <p class="text-xs text-gray-500 mt-1">Prazo final para conclusão</p>
                        </div>
                    </div>

                    <!-- Botão para definir mesma data -->
                    <div class="mt-3 flex gap-2">
                        <button type="button" id="same-day-btn"
                            class="text-xs bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-3 py-1 rounded hover:bg-gray-300 dark:hover:bg-gray-600">
                            Mesmo dia (início = término)
                        </button>
                        <button type="button" id="today-btn"
                            class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 px-3 py-1 rounded hover:bg-blue-200 dark:hover:bg-blue-800">
                            Definir para hoje
                        </button>
                    </div>

                    <div id="reschedule-button-container" class="mt-2 hidden">
                        <button type="button" id="reschedule-btn"
                            class="text-sm text-blue-500 hover:underline flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
                                    clip-rule="evenodd" />
                            </svg>
                            Reprogramar Datas
                        </button>
                    </div>

                    <div id="date-history-container" class="mt-4 hidden">
                        <h4 class="text-sm font-medium text-gray-400 mb-2">Histórico de Prazos</h4>
                        <div id="date-history-list"
                            class="text-xs text-gray-500 max-h-20 overflow-y-auto bg-gray-100 dark:bg-gray-800 p-2 rounded">
                        </div>
                    </div>
                </div>

                <!-- SEÇÃO 3: Atribuição e Dependências -->
                <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                    <h3
                        class="text-lg font-semibold mb-4 text-[var(--text-color)] border-b pb-2 flex items-center gap-2">
                        <span
                            class="bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400 w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold">3</span>
                        Responsáveis e Dependências
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Responsáveis - Layout melhorado -->
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-2">
                                Atribuir a (pode selecionar vários)
                            </label>

                            <!-- Busca de usuários -->
                            <div class="relative mb-2">
                                <input type="text" id="user-search-input"
                                    class="w-full border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-2 pl-8 text-sm"
                                    placeholder="Buscar usuário...">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    class="h-4 w-4 absolute left-2 top-3 text-gray-400" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </div>

                            <!-- Usuários selecionados (badges) -->
                            <div id="selected-users-badges" class="flex flex-wrap gap-1 mb-2 min-h-[28px]">
                                <!-- Badges dos usuários selecionados aparecerão aqui -->
                            </div>

                            <!-- Lista de usuários -->
                            <div id="assigned-users-container"
                                class="assigned-users-container border border-[var(--border-color)] rounded-md p-2 bg-[var(--card-bg)] max-h-32 overflow-y-auto">
                                <!-- Checkboxes serão inseridos aqui dinamicamente -->
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Clique para selecionar/deselecionar responsáveis</p>
                        </div>

                        <!-- Dependências e Risco -->
                        <div class="space-y-4">
                            <div>
                                <label for="task-dependency" class="block text-sm font-medium text-gray-400 mb-1">
                                    Depende de (bloqueador)
                                </label>
                                <select id="task-dependency"
                                    class="w-full border border-[var(--border-color)] bg-[var(--card-bg)] rounded-md shadow-sm p-3">
                                    <option value="">Nenhuma dependência</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">Esta tarefa só pode iniciar após a tarefa
                                    selecionada</p>
                            </div>

                            <div
                                class="flex items-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800">
                                <input type="checkbox" id="task-risk"
                                    class="h-5 w-5 text-red-600 border-gray-300 rounded focus:ring-red-500">
                                <div class="ml-3">
                                    <label for="task-risk" class="text-sm font-medium text-red-600 dark:text-red-400">
                                        Tarefa em Risco
                                    </label>
                                    <p class="text-xs text-gray-500">Marque se houver impedimentos ou riscos</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SEÇÃO 4: Progresso e Comentários/Atividade -->
                <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4 text-[var(--text-color)] border-b pb-2">Progresso e
                        Comunicação</h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Progresso -->
                        <div>
                            <label for="task-progress" class="block text-sm font-medium text-gray-400 mb-1">Progresso
                                (%)</label>
                            <div class="flex items-center space-x-3">
                                <input type="range" id="task-progress-range" min="0" max="100" class="flex-1" value="0">
                                <input type="number" id="task-progress" min="0" max="100"
                                    class="w-20 border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-2 text-center"
                                    value="0" required>
                                <span class="text-gray-400">%</span>
                            </div>
                            <p id="progress-info" class="text-xs text-gray-500 mt-1 hidden">O progresso de tarefas-pai é
                                calculado automaticamente.</p>
                        </div>

                        <!-- Abas de Comentários e Atividade -->
                        <div>
                            <div class="tab-container">
                                <div class="tab active" data-tab="comments">Comentários</div>
                                <div class="tab" data-tab="activity">Atividade</div>
                            </div>

                            <!-- Conteúdo das Abas -->
                            <div class="tab-content active" id="comments-tab">
                                <div id="comments-list"
                                    class="text-sm text-gray-500 max-h-40 overflow-y-auto bg-gray-100 dark:bg-gray-800 p-3 rounded shadow-inner mb-3">
                                </div>

                                <div class="flex gap-2 relative">
                                    <input type="text" id="new-comment-input"
                                        class="flex-grow border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-2"
                                        placeholder="Adicionar comentário...">
                                    <button type="button" id="add-comment-btn"
                                        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20"
                                            fill="currentColor">
                                            <path fill-rule="evenodd"
                                                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                                                clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                    <!-- Sugestões de Menções -->
                                    <div id="mention-suggestions" class="mention-suggestions"></div>
                                </div>
                            </div>

                            <div class="tab-content" id="activity-tab">
                                <div id="activity-list"
                                    class="text-sm text-gray-500 max-h-40 overflow-y-auto bg-gray-100 dark:bg-gray-800 p-3 rounded shadow-inner">
                                    <!-- Histórico de atividade será inserido aqui -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NOVA SEÇÃO: Anexos -->
                <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4 text-[var(--text-color)] border-b pb-2">Anexos</h3>

                    <div class="upload-area" id="upload-area">
                        <div class="upload-icon">📎</div>
                        <div class="upload-text">Arraste arquivos aqui ou clique para fazer upload</div>
                        <input type="file" id="file-upload" class="upload-input" multiple>
                    </div>

                    <div id="attachments-container" class="attachments-container">
                        <!-- Lista de anexos será inserida aqui -->
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="flex justify-end gap-3 pt-4 border-t border-[var(--border-color)]">
                    <button type="button"
                        class="cancel-btn bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-6 py-3 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors font-medium">
                        Cancelar
                    </button>
                    <button type="submit"
                        class="bg-orange-500 text-white px-6 py-3 rounded-md hover:bg-orange-600 transition-colors font-medium flex items-center shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                        Salvar Tarefa
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div id="confirm-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center no-print modal-transition modal-hidden modal-z-70">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h2 id="confirm-modal-title" class="text-xl font-bold mb-4 text-[var(--text-color)]">Confirmar Ação</h2>
            <p id="confirm-modal-body" class="mb-6 text-gray-400">Você tem certeza?</p>
            <div class="flex justify-end gap-2">
                <button id="confirm-cancel-btn"
                    class="bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">Cancelar</button>
                <button id="confirm-ok-btn"
                    class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação de Data de Subtarefa -->
    <div id="subtask-date-confirm-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-[80] no-print modal-transition modal-hidden">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-md">
            <h2 class="text-xl font-bold mb-4 text-[var(--text-color)]">Ajustar Data da Tarefa Pai</h2>
            <p id="subtask-date-confirm-body" class="mb-6 text-gray-400">
                A data de início da subtarefa é anterior à data da tarefa pai.
                Deseja alterar a data da tarefa pai?
            </p>
            <div class="flex justify-between items-center mb-4">
                <label class="flex items-center">
                    <input type="checkbox" id="update-parent-dates"
                        class="h-4 w-4 text-blue-600 border-gray-300 rounded" checked>
                    <span class="ml-2 text-sm font-medium">Atualizar datas da tarefa pai</span>
                </label>
            </div>
            <div class="flex justify-end gap-2">
                <button id="subtask-date-cancel-btn"
                    class="bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">Cancelar</button>
                <button id="subtask-date-confirm-btn"
                    class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Alertas/Lembretes -->
    <div id="alerts-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-[100] no-print modal-transition modal-hidden">
        <div
            class="bg-[var(--card-bg)] rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden alerts-modal-content">
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 p-5">
                <h2 class="text-xl font-bold text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z" />
                    </svg>
                    Lembretes do Dia
                </h2>
                <p class="text-blue-100 text-sm mt-1" id="alerts-date"></p>
            </div>

            <div class="p-5 max-h-[60vh] overflow-y-auto">
                <!-- Tarefas Atrasadas -->
                <div id="alerts-overdue-section" class="mb-5 hidden">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-2xl">⚠️</span>
                        <h3 class="font-bold text-red-600 dark:text-red-400 text-lg">Tarefas Atrasadas</h3>
                        <span id="alerts-overdue-count"
                            class="bg-red-600 text-white text-xs px-2 py-1 rounded-full"></span>
                    </div>
                    <div id="alerts-overdue-list" class="space-y-2">
                        <!-- Lista de tarefas atrasadas -->
                    </div>
                </div>

                <!-- Tarefas de Hoje -->
                <div id="alerts-today-section" class="hidden">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-2xl">📅</span>
                        <h3 class="font-bold text-green-600 dark:text-green-400 text-lg">Tarefas para Hoje</h3>
                        <span id="alerts-today-count"
                            class="bg-green-600 text-white text-xs px-2 py-1 rounded-full"></span>
                    </div>
                    <div id="alerts-today-list" class="space-y-2">
                        <!-- Lista de tarefas de hoje -->
                    </div>
                </div>

                <!-- Nenhum alerta -->
                <div id="alerts-empty" class="text-center py-8 hidden">
                    <span class="text-5xl mb-4 block">🎉</span>
                    <h3 class="font-bold text-lg text-[var(--text-color)]">Tudo em dia!</h3>
                    <p class="text-gray-500 mt-2">Você não tem tarefas atrasadas ou para hoje.</p>
                </div>
            </div>

            <div class="p-4 border-t border-[var(--border-color)] flex justify-end">
                <button id="alerts-close-btn"
                    class="bg-orange-500 text-white px-6 py-2 rounded-md hover:bg-orange-600 transition-colors font-medium shadow-lg">
                    Entendido
                </button>
            </div>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <div class="relative min-h-screen">
        <input type="file" id="import-excel-input" class="hidden" accept=".xlsx, .xls">
        <div id="logged-in-container" class="hidden">
            <!-- NOVO: Botão de Relatórios (Admin/Gestor only) -->
            <div id="reports-btn-container" class="no-print fixed top-4 right-52 z-50 hidden">
                <a href="reports.html" id="reports-link"
                    class="inline-flex items-center gap-2 p-2 px-4 rounded-full bg-purple-500 text-white hover:bg-purple-600 transition-colors shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
                    </svg>
                    <span class="text-sm font-medium">Relatórios</span>
                </a>
            </div>

            <!-- NOVO: Botão de notificações -->
            <div class="notification-bell no-print fixed top-4 right-40 z-50">
                <button id="notification-btn"
                    class="p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition-colors relative">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z" />
                    </svg>
                    <div id="notification-badge" class="notification-badge hidden">0</div>
                </button>
                <div id="notification-dropdown" class="notification-dropdown">
                    <div class="notification-header p-4 border-b border-[var(--border-color)]">
                        <h3 class="font-bold text-lg">Notificações</h3>
                    </div>
                    <div id="notification-list" class="max-h-80 overflow-y-auto">
                        <!-- Notificações serão inseridas aqui -->
                    </div>
                    <div class="notification-actions">
                        <button id="mark-all-read-btn" class="text-sm text-blue-500 hover:underline">Marcar todas como
                            lidas</button>
                        <button id="clear-notifications-btn"
                            class="text-sm text-gray-500 hover:underline">Limpar</button>
                    </div>
                </div>
            </div>

            <button id="theme-toggle"
                class="no-print fixed top-4 right-4 z-50 p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                <svg id="theme-icon-sun" class="h-6 w-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                    </path>
                </svg>
                <svg id="theme-icon-moon" class="h-6 w-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z">
                    </path>
                </svg>
            </button>
            <!-- NOVO: Botão de Gestão de Setores (Admin) -->
            <button id="sector-management-btn"
                class="no-print fixed top-4 right-16 z-50 p-2 rounded-full bg-purple-500 text-white hover:bg-purple-600 transition-colors hidden"
                title="Gerir Setores">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M3 3h8v8H3V3zm2 2v4h4V5H5zm8-2h8v8h-8V3zm2 2v4h4V5h-4zM3 13h8v8H3v-8zm2 2v4h4v-4H5zm13 0v6h2v-6h-2zm-4 2v4h2v-4h-2zm8 0v4h2v-4h-2z" />
                </svg>
            </button>
            <button id="user-management-btn"
                class="no-print fixed top-4 right-28 z-50 p-2 rounded-full bg-yellow-500 text-white hover:bg-yellow-600 transition-colors hidden"
                title="Gerir Utilizadores">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.38 0 2.5 1.12 2.5 2.5S13.38 10 12 10 9.5 8.88 9.5 7.5 10.62 5 12 5zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.8 6-3.8s5.97 1.81 6 3.8c-1.29 1.94-3.5 3.22-6 3.22z" />
                </svg>
            </button>
            <button id="logout-btn"
                class="no-print fixed top-4 right-40 z-50 p-2 rounded-full bg-red-500 text-white hover:bg-red-600 transition-colors"
                title="Logout">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z" />
                </svg>
            </button>
        </div>

        <!-- Vista de Projetos -->
        <div id="project-view" class="container mx-auto p-4 md:p-8 hidden">
            <!-- Logo Vinci Projects -->
            <div class="flex items-center gap-3 mb-4">
                <img src="logo-topo.png" alt="Vinci Logo" class="h-12">
                <span class="text-xl font-bold" style="font-family: 'Montserrat', sans-serif; color: #2563eb;">Vinci
                    Projects</span>
            </div>

            <header class="mb-8">
                <h1 class="text-4xl font-bold">Projetos</h1>
                <p class="text-gray-400">Selecione um projeto para gerenciar ou crie um novo.</p>
                <p id="user-role-display"
                    class="text-sm font-semibold mt-2 px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-full inline-block">
                    Papel: Carregando...</p>
            </header>

            <!-- Dashboard Gráfico -->
            <div id="main-dashboard" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Os gráficos serão inseridos aqui dinamicamente -->
            </div>

            <!-- Abas de Projetos Ativos e Finalizados -->
            <div class="mb-6 border-b border-gray-300 dark:border-gray-700">
                <nav class="flex gap-4" aria-label="Tabs">
                    <button id="tab-active-projects"
                        class="project-tab active px-4 py-3 text-sm font-medium border-b-2 border-blue-600 text-blue-600 dark:text-blue-400 flex items-center gap-2">
                        <span>📁</span> Projetos Ativos
                        <span id="active-projects-count"
                            class="bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 text-xs px-2 py-0.5 rounded-full">0</span>
                    </button>
                    <button id="tab-finalized-projects"
                        class="project-tab px-4 py-3 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 flex items-center gap-2">
                        <span>✅</span> Projetos Finalizados
                        <span id="finalized-projects-count"
                            class="bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 text-xs px-2 py-0.5 rounded-full">0</span>
                    </button>
                </nav>
            </div>

            <div class="flex justify-between items-center mb-6">
                <button id="add-project-btn"
                    class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                            clip-rule="evenodd" />
                    </svg>
                    Novo Projeto
                </button>

                <!-- Botões de visualização posicionados no canto direito -->
                <div class="flex items-center gap-3" id="project-view-mode-controls">
                    <button id="view-cards-btn"
                        class="px-4 py-2 rounded-md bg-blue-600 text-white flex items-center gap-2 hover:bg-blue-700">
                        <span>🔳</span> Cards
                    </button>
                    <button id="view-list-btn"
                        class="px-4 py-2 rounded-md bg-gray-300 text-gray-800 flex items-center gap-2 hover:bg-gray-400">
                        <span>📋</span> Lista
                    </button>
                </div>
            </div>

            <!-- Vista Cards (padrão) -->
            <div id="project-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

            <!-- Vista Lista (oculta inicialmente) -->
            <div id="project-list-table"
                class="hidden bg-[var(--card-bg)] border border-[var(--border-color)] rounded-lg shadow-md p-4 no-print">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs uppercase bg-gray-700 text-gray-300">
                            <tr>
                                <th class="p-3">Projeto</th>
                                <th class="p-3">Responsável</th>
                                <th class="p-3">Progresso</th>
                                <th class="p-3">Status</th>
                                <th class="p-3">Início</th>
                                <th class="p-3">Término</th>
                                <th class="p-3 text-center">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="project-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Vista do Dashboard do Projeto -->
        <div id="dashboard-view" class="container mx-auto p-4 md:p-8 hidden">
            <!-- Logo Vinci Projects -->
            <div class="flex items-center gap-3 mb-4">
                <svg width="40" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="48" height="48" rx="10" fill="url(#vinci-dash)" />
                    <text x="24" y="30" text-anchor="middle" fill="#2563eb" font-family="Montserrat, sans-serif"
                        font-weight="800" font-size="22">V</text>
                    <defs>
                        <linearGradient id="vinci-dash" x1="0" y1="0" x2="48" y2="48" gradientUnits="userSpaceOnUse">
                            <stop stop-color="#1e1e1e" />
                            <stop offset="1" stop-color="#2d2d2d" />
                        </linearGradient>
                    </defs>
                </svg>
                <span class="text-xl font-bold" style="font-family: 'Montserrat', sans-serif; color: #2563eb;">Vinci
                    Projects</span>
            </div>

            <header class="mb-8">
                <button id="back-to-projects-btn"
                    class="text-sm text-blue-500 hover:underline mb-2 flex items-center gap-1 no-print">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                    </svg>
                    Voltar para Projetos
                </button>
                <div class="flex justify-between items-start">
                    <div>
                        <h1 id="project-title" class="text-4xl font-bold">Nome do Projeto</h1>
                        <p class="text-gray-400">Painel de controle do projeto.</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <!-- Botão para editar datas do projeto -->
                        <button id="edit-project-dates-btn"
                            class="no-print bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-3 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"
                                    clip-rule="evenodd" />
                            </svg>
                            Editar
                        </button>

                        <!-- Botão para finalizar projeto (só aparece quando 100%) -->
                        <button id="finalize-project-btn"
                            class="no-print hidden bg-green-600 text-white px-3 py-2 rounded-md hover:bg-green-700 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                    clip-rule="evenodd" />
                            </svg>
                            Finalizar Projeto
                        </button>

                        <!-- Botão para reabrir projeto (só aparece em projetos finalizados) -->
                        <button id="reopen-project-btn"
                            class="no-print hidden bg-amber-600 text-white px-3 py-2 rounded-md hover:bg-amber-700 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
                                    clip-rule="evenodd" />
                            </svg>
                            Reabrir Projeto
                        </button>
                    </div>
                </div>
                <!-- NOVO: Exibição das datas do projeto -->
                <div id="project-dates-display" class="mt-2 text-sm text-gray-500">
                    <span id="project-start-date-display"></span> a <span id="project-end-date-display"></span>
                    <span id="project-date-auto"
                        class="ml-2 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 px-2 py-1 rounded hidden">Datas
                        automáticas</span>
                    <span id="project-date-manual"
                        class="ml-2 text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 px-2 py-1 rounded hidden">Datas
                        manuais</span>
                </div>
                <div id="today-tasks-info" class="mt-2"></div>
            </header>
            <div id="kpi-dashboard" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8"></div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
                <div
                    class="lg:col-span-3 bg-[var(--card-bg)] p-4 rounded-lg shadow-md flex flex-wrap items-center justify-between gap-4 no-print border border-[var(--border-color)]">
                    <div class="flex items-center gap-4 flex-wrap">
                        <button id="add-task-btn"
                            class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center gap-2"
                            title="Criar uma nova tarefa manualmente">Nova
                            Tarefa</button>
                        <button id="import-excel-btn"
                            class="bg-teal-600 text-white px-4 py-2 rounded-md hover:bg-teal-700 flex items-center gap-2"
                            title="Importar tarefas usando o Template padrão do sistema (use 'Baixar Template' para obter o modelo)">Importar</button>
                        <button id="import-msproject-btn"
                            class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 flex items-center gap-2"
                            title="Importar arquivo Excel exportado do Microsoft Project">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            MS Project
                        </button>
                        <input type="file" id="import-msproject-input" class="hidden" accept=".xlsx, .xls">
                        <button id="import-legacy-btn"
                            class="bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 flex items-center gap-2"
                            title="Importar planilhas com modelo utilizado anteriormente (detecta automaticamente os cabeçalhos)">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Excel Antigo
                        </button>
                        <input type="file" id="import-legacy-input" class="hidden" accept=".xlsx, .xls">
                        <button id="download-template-btn" class="text-sm text-blue-500 hover:underline"
                            title="Baixar modelo de planilha Excel para importação de tarefas">Baixar
                            Template</button>
                    </div>


                    <div class="relative">
                        <input type="text" id="task-filter-input" placeholder="Filtrar tarefas..."
                            class="border border-[var(--border-color)] bg-transparent rounded-md shadow-sm p-2 pl-8 text-sm">
                        <svg class="absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"
                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2"><label for="view-switcher"
                                class="text-sm font-medium">Visualização:</label><select id="view-switcher"
                                class="border border-[var(--border-color)] rounded-md p-2 text-sm bg-[var(--card-bg)]"
                                title="Alternar entre visualização em Tabela ou Gráfico de Gantt">
                                <option value="table" selected>Tabela</option>
                                <option value="gantt">Gantt</option>
                            </select></div>
                        <button id="export-excel-btn"
                            class="bg-green-600 text-white px-3 py-2 rounded-md hover:bg-green-700"
                            title="Exportar todas as tarefas para uma planilha Excel">Excel</button>
                        <button id="export-msproject-btn"
                            class="bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700"
                            title="Exportar para formato XML compatível com Microsoft Project">MS Project</button>
                        <button id="generate-pdf-report-btn"
                            class="bg-red-600 text-white px-3 py-2 rounded-md hover:bg-red-700"
                            title="Gerar relatório do projeto em formato PDF">PDF</button>
                        <button id="print-view-btn"
                            class="bg-gray-500 text-white px-3 py-2 rounded-md hover:bg-gray-600"
                            title="Abrir janela de impressão do navegador">Imprimir</button>
                    </div>

                </div>
                <div id="assignee-summary"
                    class="bg-[var(--card-bg)] p-4 rounded-lg shadow-md border border-[var(--border-color)] no-print">
                    <h3 class="font-bold mb-2">Tarefas por Responsável</h3>
                    <div id="assignee-summary-list" class="text-sm space-y-2 max-h-48 overflow-y-auto"></div>
                </div>
            </div>

            <main id="content-area"
                class="bg-[var(--card-bg)] p-4 rounded-lg shadow-md border border-[var(--border-color)]">
                <div id="table-view">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-400">
                            <thead class="text-xs uppercase bg-gray-700 text-gray-400">
                                <tr>
                                    <th class="p-3 min-w-[250px]">Tarefa</th>
                                    <th class="p-3">Duração (dias)</th>
                                    <th class="p-3">Data de Início</th>
                                    <th class="p-3">Data de Término</th>
                                    <th class="p-3">Status</th>
                                    <th class="p-3">Responsável</th>
                                    <th class="p-3">Comentários</th>
                                    <th class="p-3 text-center no-print">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="task-table-body"></tbody>
                        </table>
                    </div>
                </div>
                <div id="gantt-view" class="hidden">
                    <div class="gantt-chart-container border border-[var(--border-color)] rounded-lg">
                        <svg id="gantt-dependency-lines" width="100%" height="100%"></svg>
                        <div
                            class="gantt-tasks bg-gray-700 bg-opacity-20 border-r border-[var(--border-color)] p-2 font-bold">
                            <div class="h-10 flex items-center">Tarefa</div>
                            <div id="gantt-task-names" class="relative"></div>
                        </div>
                        <div class="gantt-timeline-container overflow-x-auto">
                            <div id="gantt-header"
                                class="sticky top-0 bg-gray-700 bg-opacity-20 z-10 border-b border-[var(--border-color)]">
                            </div>
                            <div id="gantt-timeline-body" class="relative"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- MODAL: User Management -->
    <div id="user-management-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center no-print modal-transition modal-hidden modal-z-60">
        <div class="bg-[var(--card-bg)] rounded-lg shadow-xl p-6 w-full max-w-5xl max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold mb-4 text-[var(--text-color)]">Gerenciar Usuários</h2>
            <p class="text-gray-400 text-sm mb-4">
                Controle de acesso e permissões de usuários do sistema.
            </p>
            <div id="user-list-container" class="overflow-y-auto max-h-96">
                <table class="w-full text-sm text-left text-gray-400">
                    <thead class="text-xs uppercase bg-gray-700 text-gray-400 sticky top-0">
                        <tr>
                            <th class="p-3">Nome</th>
                            <th class="p-3">Email</th>
                            <th class="p-3">Papel</th>
                            <th class="p-3">Status</th>
                            <th class="p-3 text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="user-management-table-body">
                    </tbody>
                </table>
            </div>
            <div class="flex justify-end mt-4">
                <button type="button"
                    class="cancel-btn bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500">Fechar</button>
            </div>
        </div>
    </div>



    <script type="module" src="js/app.js"></script>
</body>

</html>